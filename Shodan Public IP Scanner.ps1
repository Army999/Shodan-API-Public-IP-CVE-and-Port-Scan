# Adjust the IP address and Key as needed
$shodanUrl = "https://api.shodan.io/shodan/host/(Public IP Address Here)?key=(Your Key Here)"


$response = Invoke-WebRequest -Uri $shodanUrl

if ($response.StatusCode -eq 200) {
    # Convert the response content to JSON format
    $responseData = $response.Content | ConvertFrom-Json

    # Extract general information from the response
    $ip = $responseData.ip_str
    $organization = $responseData.org
    $country = $responseData.country_code
    $asn = $responseData.asn
    $domain = $responseData.domains -join ', '
    $cve = $responseData.vulns -join ', '

    # Extract port information from the response
    $ports = $responseData.ports -join ', '

    # Create an object to store general data
    $generalData = [PSCustomObject]@{
        "IP Address" = $ip
        "Organization" = $organization
        "Country" = $country
        "ASN" = $asn
        "Ports" = $ports   
        "Domain" = $domain
        "CVE" = $cve
    }

    # Check if CVE information is available
    if ($responseData.vulns) {
        # Array to store combined data
        $combinedData = @()

            # Create an object to store CVE data
            $cveObject = [PSCustomObject]@{
                "IP Address" = $ip
                "Organization" = $organization
                "ASN" = $asn
                "Ports" = $ports
                "Domain" = $domain
                "CVE" = $cve
            }

            # Add CVE data object to the array
            $combinedData += $cveObject
        }

        # Convert the combined data to CSV and save it to a file
        $combinedData | Export-Csv -Path "C:\temp\shodan_scan_results.csv" -NoTypeInformation

       }
